# üö® LIMPEZA URGENTE DE MALWARE RBOT

## ‚ö†Ô∏è SITUA√á√ÉO CR√çTICA
Malware rbot detectado em containers Docker. Executar IMEDIATAMENTE.

---

## üìã INSTRU√á√ïES PASSO A PASSO

### **PASSO 1: Parar TODOS os containers**
```bash
cd /var/www/vap-landing
docker compose down
```

### **PASSO 2: Verificar se containers pararam**
```bash
docker ps -a
```
**Resultado esperado**: Nenhum container rodando ou apenas containers stopped

### **PASSO 3: Deletar TODAS as imagens Docker**
```bash
# Listar todas as imagens
docker images

# Deletar TODAS as imagens (incluindo as infectadas)
docker rmi -f $(docker images -q)
```

### **PASSO 4: Limpar TODO o sistema Docker**
```bash
# Este comando remove:
# - Todos os containers parados
# - Todas as redes n√£o utilizadas
# - Todas as imagens dangling
# - Todo o cache de build
# - TODOS OS VOLUMES (cuidado se tiver dados importantes)
docker system prune -af --volumes
```

**‚ö†Ô∏è ATEN√á√ÉO**: Este comando √© DESTRUTIVO. Vai remover TUDO do Docker.

### **PASSO 5: Verificar se malware foi removido**
```bash
# Buscar novamente por rbot
sudo find /var/lib/docker -name "*rbot*" -type f 2>/dev/null

# Se ainda aparecer, deletar manualmente:
sudo rm -rf /var/lib/docker/overlay2
sudo systemctl restart docker
```

### **PASSO 6: Resolver conflito do Git**
```bash
cd /var/www/vap-landing

# Salvar mudan√ßas locais temporariamente
git stash

# Puxar c√≥digo limpo e atualizado
git pull origin main

# Verificar se est√° na vers√£o correta
git log --oneline -n 3
```

**Voc√™ deve ver estes commits recentes:**
- `ad5f116` - fix(build): Adiciona arquivos necess√°rios para build
- `706366d` - fix(security): Adiciona prote√ß√µes contra DoS e rate limiting

### **PASSO 7: Instalar depend√™ncias atualizadas**
```bash
# Deletar node_modules antigo (pode ter cache infectado)
rm -rf node_modules package-lock.json

# Reinstalar do zero
npm install
```

### **PASSO 8: Build LIMPO sem cache**
```bash
# Build sem usar nenhum cache anterior
docker compose build --no-cache --pull

# Este comando vai:
# 1. Baixar imagens base NOVAS do Docker Hub
# 2. Instalar depend√™ncias do zero
# 3. Criar imagens limpas
```

**‚è±Ô∏è Este passo pode levar 5-10 minutos**

### **PASSO 9: Subir aplica√ß√£o**
```bash
docker compose up -d
```

### **PASSO 10: Verificar se est√° funcionando**
```bash
# Ver logs em tempo real
docker compose logs -f --tail=50

# Em outro terminal, verificar status
docker ps

# Verificar uso de CPU (deve estar baixo)
docker stats --no-stream
```

---

## ‚úÖ CHECKLIST DE VERIFICA√á√ÉO

Execute ap√≥s a limpeza:

### 1. Verificar se malware foi removido
```bash
sudo find / -name "*rbot*" -type f 2>/dev/null
```
**Resultado esperado**: Nenhum arquivo encontrado

### 2. Verificar processos suspeitos
```bash
ps aux | grep -i bot
ps aux | grep -i malware
```
**Resultado esperado**: Apenas o comando grep aparecendo

### 3. Verificar conex√µes ativas
```bash
sudo netstat -tuln | grep ESTABLISHED
```
**Resultado esperado**: Apenas conex√µes leg√≠timas (porta 80, 443, 3001)

### 4. Verificar uso de CPU
```bash
htop
```
**Resultado esperado**: CPU em repouso < 10%

### 5. Verificar logs da aplica√ß√£o
```bash
docker compose logs --tail=100 | grep -i error
```
**Resultado esperado**: Nenhum erro cr√≠tico

### 6. Testar aplica√ß√£o
```bash
curl http://localhost:3001
```
**Resultado esperado**: HTML da p√°gina

---

## üîí PR√ìXIMOS PASSOS AP√ìS LIMPEZA

### 1. Monitorar por 24 horas
```bash
# Script de monitoramento (rodar em segundo plano)
#!/bin/bash
while true; do
  CPU=$(docker stats --no-stream --format "{{.CPUPerc}}" | head -1 | sed 's/%//')

  if (( $(echo "$CPU > 50" | bc -l) )); then
    echo "‚ö†Ô∏è ALERTA: CPU em ${CPU}% - $(date)" >> /var/log/security-monitor.log
    # Enviar notifica√ß√£o (configurar)
  fi

  sleep 300  # Verificar a cada 5 minutos
done
```

### 2. Configurar Firewall (se ainda n√£o configurado)
```bash
sudo ufw enable
sudo ufw allow 22/tcp    # SSH
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS
sudo ufw allow 3001/tcp  # App (se necess√°rio)
sudo ufw default deny incoming
sudo ufw status verbose
```

### 3. Configurar fail2ban (opcional mas recomendado)
```bash
sudo apt update
sudo apt install fail2ban -y
sudo systemctl enable fail2ban
sudo systemctl start fail2ban
```

---

## üÜò SE O PROBLEMA PERSISTIR

Se ap√≥s seguir todos os passos o malware continuar aparecendo ou CPU continuar alta:

### Op√ß√£o 1: Reinstalar Docker
```bash
sudo apt remove docker docker-engine docker.io containerd runc
sudo apt update
sudo apt install docker.io docker-compose -y
sudo systemctl start docker
sudo systemctl enable docker
```

### Op√ß√£o 2: Contatar Hostinger Support
- Abrir ticket urgente informando:
  - Malware rbot detectado e removido
  - Medidas de seguran√ßa implementadas
  - Solicitar verifica√ß√£o do host

### Op√ß√£o 3: Migrar para novo VPS (√∫ltima op√ß√£o)
- Se o VPS estiver comprometido a n√≠vel de sistema operacional

---

## üìä COMO SABER SE EST√Å SEGURO

‚úÖ **Sinais de que est√° limpo:**
- CPU em repouso < 10%
- Nenhum processo suspeito rodando
- Nenhum arquivo rbot encontrado
- Logs sem erros de rate limiting em massa
- Aplica√ß√£o respondendo normalmente

‚ùå **Sinais de que ainda h√° problema:**
- CPU constantemente > 50%
- Processos desconhecidos rodando
- Conex√µes para IPs desconhecidos
- Logs com milhares de requisi√ß√µes por segundo
- Docker reiniciando sozinho

---

## üí° PREVEN√á√ÉO FUTURA

J√° implementado no c√≥digo (commit 706366d):
- ‚úÖ Rate limiting nas APIs
- ‚úÖ Body size limit (1MB)
- ‚úÖ Headers de seguran√ßa
- ‚úÖ Next.js atualizado (15.5.11)
- ‚úÖ React atualizado (19.1.0)

**Manter sempre:**
- Depend√™ncias atualizadas mensalmente
- Monitoramento de CPU ativo
- Backups di√°rios
- Logs sendo salvos e analisados

---

## üéØ RESUMO DOS COMANDOS

```bash
# 1. Parar e limpar Docker
cd /var/www/vap-landing
docker compose down
docker rmi -f $(docker images -q)
docker system prune -af --volumes

# 2. Atualizar c√≥digo
git stash
git pull origin main

# 3. Reinstalar depend√™ncias
rm -rf node_modules package-lock.json
npm install

# 4. Build limpo
docker compose build --no-cache --pull
docker compose up -d

# 5. Verificar
docker ps
docker compose logs -f --tail=50
docker stats --no-stream
```

---

**‚è∞ Tempo estimado total: 15-20 minutos**

**üö® EXECUTAR AGORA PARA EVITAR SUSPENS√ÉO DO VPS**
